#!/bin/bash
set -euo pipefail

DOTFILES="$HOME/dotfiles"
CONFIG="$HOME/.config"

safe_link() {
    local src="$1"
    local dest="$2"

    if [ -L "$dest" ] && [ "$(readlink "$dest")" = "$src" ]; then
        echo "âœ” Skipping: $dest already â†’ $src"
        return
    fi

    if [ -e "$dest" ] || [ -L "$dest" ]; then
        mv "$dest" "${dest}-bak"
        echo "ðŸ“¦ Backed up $dest â†’ ${dest}-bak"
    fi

    mkdir -p "$(dirname "$dest")"

    ln -s "$src" "$dest"
    echo "ðŸ”— Linked $src â†’ $dest"
}

# Extra
# safe_link "$DOTFILES/extra/wezterm" "$CONFIG/wezterm"
# safe_link "$DOTFILES/extra/helix"   "$CONFIG/helix"

# Core
safe_link "$DOTFILES/nvim"          "$CONFIG/nvim"
safe_link "$DOTFILES/ghostty"       "$CONFIG/ghostty"
safe_link "$DOTFILES/fish"          "$CONFIG/fish"
safe_link "$DOTFILES/zellij"        "$CONFIG/zellij"

safe_link "$DOTFILES/starship.toml" "$CONFIG/starship.toml"
safe_link "$DOTFILES/.ignore"       "$HOME/.ignore"
safe_link "$DOTFILES/.gitconfig"    "$HOME/.gitconfig"

# Macos
if [[ "$(uname)" == "Darwin" ]]; then
    safe_link "$DOTFILES/macos/hammerspoon" "$HOME/.hammerspoon"
    safe_link "$DOTFILES/macos/aerospace"   "$CONFIG/aerospace"
fi
